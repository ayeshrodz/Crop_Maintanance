package test_file
public
	
-- SYSTEM

system SecuritySystem
end SecuritySystem;

system implementation SecuritySystem.with_devices
	subcomponents
		-- must be defined before adding to the system subcomponents
		this_motion_sensor: device MotionSensor; -- inside_name: type OutSideName;
		this_magnetic_alarm_sensor: device MagneticAlarmSensor;
		this_camera: device Camera;
		this_alarm_unit: device AlarmUnit; -- capture::AlarmUnit;
		
		-- PROCESS CONTROLLER
		this_controller: process Controller;
		
		-- HARDWARE
		this_processor: processor MainProcessor.impl;
		this_bus: bus HWConn.impl;
		
		-- CONNECTIONS: sent from the devices to the PROCESS CONTROLLER
	connections 
		motion_conn: port this_motion_sensor.motion_detected -> this_controller.motion_in;
		magnetic_conn: port this_magnetic_alarm_sensor.door_open -> this_controller.magnetic_in;
		camera_conn_out: port this_controller.camera_out -> this_camera.camera_on_off;
		alarm_conn: port this_controller.alarm_out -> this_alarm_unit.alarm_on_off;
		camera_conn_in: port this_camera.camera_video_feed -> this_controller.camera_video;
		
		-- BUS CONNECTIONS: added after creating the Bus
		bus_motion: bus access this_bus -> this_motion_sensor.bus_access;
		bus_magnet: bus access this_bus -> this_magnetic_alarm_sensor.bus_access;
		bus_camera: bus access this_bus -> this_camera.bus_access;
		bus_alarm: bus access this_bus -> this_alarm_unit.bus_access;
		
		bus_processor: bus access this_bus -> this_processor.bus_access;
		
end SecuritySystem.with_devices;
	
-- DEVICES 4 , IMPL 4
	
device MotionSensor
	features
		motion_detected: out event port;
		bus_access: requires bus access HWConn; -- Added finally after making the bus
end MotionSensor;

device implementation MotionSensor.impl
end MotionSensor.impl;

device MagneticAlarmSensor
	features
		door_open: out event port;
		bus_access: requires bus access HWConn; -- Added finally after making the bus
end MagneticAlarmSensor;

device implementation MagneticAlarmSensor.impl
end MagneticAlarmSensor.impl;

device Camera
	features
		camera_on_off: in event port;
		camera_video_feed: out data port;
		bus_access: requires bus access HWConn; -- Added finally after making the bus
end Camera;

device implementation Camera.impl
end Camera.impl;

device AlarmUnit
	features
		alarm_on_off: in event port;
		bus_access: requires bus access HWConn; -- Added finally after making the bus
end AlarmUnit;

device implementation AlarmUnit.impl
end AlarmUnit.impl;

-- PROCESS CONTROLLER

process Controller
	features
		motion_in: in event port;
		magnetic_in: in event port;
		camera_out: out event port;
		alarm_out: out event port;
		camera_video: in event port;
	
end Controller;

process implementation Controller.with_threads
	
end Controller.with_threads;

-- PROCESSOR
processor MainProcessor
	features
		bus_access: requires bus access HWConn; -- Added finally after making the bus
end MainProcessor;

processor implementation MainProcessor.impl
end MainProcessor.impl;

--RAM
memory Ram
end Ram;

memory implementation Ram.impl
end Ram.impl;

-- BUS
bus HWConn
end HWConn;

bus implementation HWConn.impl
end HWConn.impl;
	
	
end test_file;
	